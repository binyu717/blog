<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaMail 的使用 | JAVA之路</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" type="image/x-icon" href="./avatar.png">
    <meta name="description" content="行你所行，听从你心">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b6bfb1ac.css" as="style"><link rel="preload" href="/blog/assets/js/app.f7a9413c.js" as="script"><link rel="preload" href="/blog/assets/js/2.ddedf7b8.js" as="script"><link rel="preload" href="/blog/assets/js/25.b990b784.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.28823f80.js"><link rel="prefetch" href="/blog/assets/js/11.907d6de2.js"><link rel="prefetch" href="/blog/assets/js/12.e0480859.js"><link rel="prefetch" href="/blog/assets/js/13.197b8968.js"><link rel="prefetch" href="/blog/assets/js/14.327ec1cf.js"><link rel="prefetch" href="/blog/assets/js/15.e4a62733.js"><link rel="prefetch" href="/blog/assets/js/16.7e8254c4.js"><link rel="prefetch" href="/blog/assets/js/17.a5fd2c58.js"><link rel="prefetch" href="/blog/assets/js/18.09512bd4.js"><link rel="prefetch" href="/blog/assets/js/19.4093ac92.js"><link rel="prefetch" href="/blog/assets/js/20.0a325460.js"><link rel="prefetch" href="/blog/assets/js/21.41949fa9.js"><link rel="prefetch" href="/blog/assets/js/22.aebd4cfb.js"><link rel="prefetch" href="/blog/assets/js/23.f9a7fbea.js"><link rel="prefetch" href="/blog/assets/js/24.e1b48ee8.js"><link rel="prefetch" href="/blog/assets/js/26.a87045c1.js"><link rel="prefetch" href="/blog/assets/js/27.054622f5.js"><link rel="prefetch" href="/blog/assets/js/28.641f720a.js"><link rel="prefetch" href="/blog/assets/js/29.4b365e5d.js"><link rel="prefetch" href="/blog/assets/js/3.b2bfae33.js"><link rel="prefetch" href="/blog/assets/js/30.46ac7154.js"><link rel="prefetch" href="/blog/assets/js/31.396b63a7.js"><link rel="prefetch" href="/blog/assets/js/32.27b8aea8.js"><link rel="prefetch" href="/blog/assets/js/33.2bdab81b.js"><link rel="prefetch" href="/blog/assets/js/34.0c7b821a.js"><link rel="prefetch" href="/blog/assets/js/35.2c48d1d3.js"><link rel="prefetch" href="/blog/assets/js/4.fbcf4621.js"><link rel="prefetch" href="/blog/assets/js/5.ec4b3f90.js"><link rel="prefetch" href="/blog/assets/js/6.27888615.js"><link rel="prefetch" href="/blog/assets/js/7.e23a1d77.js"><link rel="prefetch" href="/blog/assets/js/8.1314a140.js"><link rel="prefetch" href="/blog/assets/js/9.4472f6b1.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b6bfb1ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">JAVA之路</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://caibaojian.com/vuepress/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://caibaojian.com/vuepress/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>java</span> <span class="arrow down"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>oracle</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>postgresql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mybatis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>windows</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>单元测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>问题积累</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>读书笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="javamail-的使用"><a href="#javamail-的使用" class="header-anchor">#</a> JavaMail 的使用</h2> <p>最近项目有个拉取邮箱邮件的需求，了解了JavaMail的使用，先记录下</p> <h3 id="接收邮件"><a href="#接收邮件" class="header-anchor">#</a> 接收邮件</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 接收邮件
 * @Date 2018/6/26
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetEmailUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> receivingServer <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> mailProtocol <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> email <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> port <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> isSsl <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// Calling checkMail method to check received emails</span>
        <span class="token function">checkMail</span><span class="token punctuation">(</span>receivingServer<span class="token punctuation">,</span> port<span class="token punctuation">,</span>mailProtocol<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">,</span>isSsl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">checkMail</span><span class="token punctuation">(</span><span class="token class-name">String</span> receivingServer<span class="token punctuation">,</span> <span class="token class-name">String</span> port<span class="token punctuation">,</span><span class="token class-name">String</span> mailProtocol<span class="token punctuation">,</span> <span class="token class-name">String</span> email<span class="token punctuation">,</span><span class="token class-name">String</span> password<span class="token punctuation">,</span><span class="token class-name">String</span> isSsl<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;imap&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mailProtocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">processImapEmail</span><span class="token punctuation">(</span>receivingServer<span class="token punctuation">,</span> port<span class="token punctuation">,</span> mailProtocol<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> isSsl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;pop3&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mailProtocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">processPop3Email</span><span class="token punctuation">(</span>receivingServer<span class="token punctuation">,</span> port<span class="token punctuation">,</span> mailProtocol<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> isSsl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">processImapEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> receivingServer<span class="token punctuation">,</span> <span class="token class-name">String</span> port<span class="token punctuation">,</span>
                                <span class="token class-name">String</span> mailProtocol<span class="token punctuation">,</span> <span class="token class-name">String</span> email<span class="token punctuation">,</span><span class="token class-name">String</span> password<span class="token punctuation">,</span><span class="token class-name">String</span> isSsl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Store</span> storeObj<span class="token punctuation">;</span>
        <span class="token class-name">Session</span> emailSessionObj<span class="token punctuation">;</span>
        <span class="token class-name">Properties</span> propvals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 连接参数</span>
            propvals<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.imap.host&quot;</span><span class="token punctuation">,</span> receivingServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            propvals<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.imap.port&quot;</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
            propvals<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.store.protocol&quot;</span><span class="token punctuation">,</span> mailProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
            propvals<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;mail.imap.ssl.enable&quot;</span><span class="token punctuation">,</span> isSsl<span class="token punctuation">)</span><span class="token punctuation">;</span>
            emailSessionObj <span class="token operator">=</span> <span class="token class-name">Session</span><span class="token punctuation">.</span><span class="token function">getDefaultInstance</span><span class="token punctuation">(</span>propvals<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取对象，连接到服务器 </span>
            storeObj <span class="token operator">=</span> emailSessionObj<span class="token punctuation">.</span><span class="token function">getStore</span><span class="token punctuation">(</span>mailProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
            storeObj<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>receivingServer<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 创建folder对象，打开方式有只读与读写</span>
            <span class="token class-name">IMAPFolder</span> emailFolderObj <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">IMAPFolder</span><span class="token punctuation">)</span>storeObj<span class="token punctuation">.</span><span class="token function">getFolder</span><span class="token punctuation">(</span><span class="token string">&quot;INBOX&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            emailFolderObj<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">Folder</span><span class="token punctuation">.</span>READ_ONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取下一个uid值，UID对于POP3是字符串类型，IMAP是数值类型且递增，</span>
            <span class="token keyword">long</span> uidNext <span class="token operator">=</span> emailFolderObj<span class="token punctuation">.</span><span class="token function">getUIDNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 邮箱邮件的总数量，不计入已删除的</span>
            <span class="token keyword">int</span> messageCount <span class="token operator">=</span> emailFolderObj<span class="token punctuation">.</span><span class="token function">getMessageCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;邮件总数量：&quot;</span><span class="token operator">+</span> messageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Message</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages <span class="token operator">=</span> emailFolderObj<span class="token punctuation">.</span><span class="token function">getMessages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// FetchProfile类提供邮件协议提供者特有可选参数，其目的是更有效地实现邮件组成成分的预提取,可增加以下三种属性，</span>
            <span class="token class-name">FetchProfile</span> fp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FetchProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">FetchProfile<span class="token punctuation">.</span>Item</span><span class="token punctuation">.</span>CONTENT_INFO<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">FetchProfile<span class="token punctuation">.</span>Item</span><span class="token punctuation">.</span>ENVELOPE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">FetchProfile<span class="token punctuation">.</span>Item</span><span class="token punctuation">.</span>FLAGS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;X-mailer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            emailFolderObj<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>messages<span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 遍历messages时，提取其内容相当耗时，这时用FetchProfile预提取可以起到一定的效果</span>
             <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> messages<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Message</span> indvidualmsg <span class="token operator">=</span> messages<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> uid <span class="token operator">=</span> emailFolderObj<span class="token punctuation">.</span><span class="token function">getUID</span><span class="token punctuation">(</span>indvidualmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                indvidualmsg<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                indvidualmsg<span class="token punctuation">.</span><span class="token function">getSentDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                indvidualmsg<span class="token punctuation">.</span><span class="token function">isMimeType</span><span class="token punctuation">(</span><span class="token string">&quot;multipart/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                indvidualmsg<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;multipart&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                indvidualmsg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
            emailFolderObj<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            storeObj<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> exp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            exp<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">processPop3Email</span><span class="token punctuation">(</span><span class="token class-name">String</span> receivingServer<span class="token punctuation">,</span> <span class="token class-name">String</span> port<span class="token punctuation">,</span>
                                <span class="token class-name">String</span> mailProtocol<span class="token punctuation">,</span> <span class="token class-name">String</span> email<span class="token punctuation">,</span><span class="token class-name">String</span> password<span class="token punctuation">,</span><span class="token class-name">String</span> isSsl<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Store</span> storeObj<span class="token punctuation">;</span>
        <span class="token class-name">Session</span> emailSessionObj<span class="token punctuation">;</span>
        <span class="token class-name">Properties</span> propvals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 连接参数</span>
            propvals<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.pop3.host&quot;</span><span class="token punctuation">,</span> receivingServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            propvals<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.pop3.port&quot;</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
            propvals<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;mail.store.protocol&quot;</span><span class="token punctuation">,</span> mailProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
            propvals<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;mail.pop3.ssl.enable&quot;</span><span class="token punctuation">,</span> isSsl<span class="token punctuation">)</span><span class="token punctuation">;</span>

            emailSessionObj <span class="token operator">=</span> <span class="token class-name">Session</span><span class="token punctuation">.</span><span class="token function">getDefaultInstance</span><span class="token punctuation">(</span>propvals<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取对象，连接到服务器 </span>
            storeObj <span class="token operator">=</span> emailSessionObj<span class="token punctuation">.</span><span class="token function">getStore</span><span class="token punctuation">(</span>mailProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
            storeObj<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>receivingServer<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 创建folder对象，打开方式有只读与读写</span>
            <span class="token class-name">POP3Folder</span> emailFolderObj <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">POP3Folder</span><span class="token punctuation">)</span>storeObj<span class="token punctuation">.</span><span class="token function">getFolder</span><span class="token punctuation">(</span><span class="token string">&quot;INBOX&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            emailFolderObj<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token class-name">Folder</span><span class="token punctuation">.</span>READ_ONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Message</span><span class="token punctuation">[</span><span class="token punctuation">]</span> messages <span class="token operator">=</span> emailFolderObj<span class="token punctuation">.</span><span class="token function">getMessages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FetchProfile</span> fp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FetchProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">FetchProfile<span class="token punctuation">.</span>Item</span><span class="token punctuation">.</span>CONTENT_INFO<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">FetchProfile<span class="token punctuation">.</span>Item</span><span class="token punctuation">.</span>ENVELOPE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">FetchProfile<span class="token punctuation">.</span>Item</span><span class="token punctuation">.</span>FLAGS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;X-mailer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            emailFolderObj<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>messages<span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> messages<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Message</span> indvidualmsg <span class="token operator">=</span> messages<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                indvidualmsg<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                indvidualmsg<span class="token punctuation">.</span><span class="token function">getSentDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                indvidualmsg<span class="token punctuation">.</span><span class="token function">isMimeType</span><span class="token punctuation">(</span><span class="token string">&quot;multipart/*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                indvidualmsg<span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;multipart&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                indvidualmsg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            emailFolderObj<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            storeObj<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> exp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            exp<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre></div><h3 id="发送邮件"><a href="#发送邮件" class="header-anchor">#</a> 发送邮件</h3> <div class="language-java extra-class"><pre class="language-java"><code>   <span class="token comment">/**
    * 发送简单邮件
    * @param server
    * @param port
    * @param mailProtocol
    * @param email
    * @param password
    * @param isSsl
    */</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> server<span class="token punctuation">,</span> <span class="token class-name">String</span> port<span class="token punctuation">,</span>
                                       <span class="token class-name">String</span> mailProtocol<span class="token punctuation">,</span> <span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> isSsl<span class="token punctuation">)</span> <span class="token punctuation">{</span>

       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           prop<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;mail.host&quot;</span><span class="token punctuation">,</span> server<span class="token punctuation">)</span><span class="token punctuation">;</span>
           prop<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;mail.transport.protocol&quot;</span><span class="token punctuation">,</span>mailProtocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
           prop<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">&quot;mail.smtp.auth&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//使用JavaMail发送邮件的5个步骤</span>
           <span class="token comment">//1、创建session</span>
           <span class="token class-name">Session</span> session <span class="token operator">=</span> <span class="token class-name">Session</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//开启Session的debug模式，这样就可以查看到程序发送Email的运行状态</span>
           session<span class="token punctuation">.</span><span class="token function">setDebug</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//2、通过session得到transport对象</span>
           <span class="token class-name">Transport</span> ts <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getTransport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//3、使用邮箱的用户名和密码连上邮件服务器，发送邮件时，发件人需要提交邮箱的用户名和密码给smtp服务器，用户名和密码都通过验证之后才能够正常发送邮件给收件人。</span>
           ts<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//4、创建邮件</span>
           <span class="token comment">//创建邮件对象</span>
           <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MimeMessage</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//指明邮件的发件人,此处需要和连接邮件服务器的用户名保持一致，否则报440</span>
           message<span class="token punctuation">.</span><span class="token function">setFrom</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InternetAddress</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//指明邮件的收件人 Message.RecipientType.TO、Message.RecipientType.CC、Message.RecipientType.BCC</span>
           message<span class="token punctuation">.</span><span class="token function">setRecipient</span><span class="token punctuation">(</span><span class="token class-name">Message<span class="token punctuation">.</span>RecipientType</span><span class="token punctuation">.</span>TO<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">InternetAddress</span><span class="token punctuation">(</span><span class="token string">&quot;478494772@qq.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//邮件的标题</span>
           message<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span><span class="token string">&quot;javaMail发送邮件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//邮件的文本内容</span>
<span class="token comment">//            message.setContent(&quot;这是一封普通邮件&quot;, &quot;text/html;charset=UTF-8&quot;);</span>
           message<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token function">createAttachContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//5、发送邮件</span>
           ts<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getAllRecipients</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           ts<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;发送失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token comment">/**
   *
   * Message表示一个邮件，messgaes.getContent()返回一个Multipart对象。一个
   * Multipart对象包含一个或多个BodyPart对象，来组成邮件的正文部分（包括附件）
   * Multipart是一个容器它转载多个body Part（正文、附件或内嵌资源）。Part的        
   * getContent()方法就返回一个Multipart对象。
   **/</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">MimeMultipart</span> <span class="token function">createAttachContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token comment">// 可包含多个MimeBodyPart,主要有三种子类型：mixed：附件、related：内嵌资源、alternative：纯文本与超文本共存。</span>
       <span class="token class-name">MimeMultipart</span> mp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MimeMultipart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token class-name">MimeBodyPart</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MimeBodyPart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           text<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">&quot;使用JavaMail创建的带附件的邮件&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//创建邮件附件</span>
           <span class="token class-name">MimeBodyPart</span> attach <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MimeBodyPart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">DataHandler</span> dh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileDataSource</span><span class="token punctuation">(</span><span class="token string">&quot;C:\\Users\\Administrator\\Desktop\\oneKey.bat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           attach<span class="token punctuation">.</span><span class="token function">setDataHandler</span><span class="token punctuation">(</span>dh<span class="token punctuation">)</span><span class="token punctuation">;</span>
           attach<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>dh<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment">//创建容器描述数据关系</span>
           mp<span class="token punctuation">.</span><span class="token function">addBodyPart</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
           mp<span class="token punctuation">.</span><span class="token function">addBodyPart</span><span class="token punctuation">(</span>attach<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//</span>
           mp<span class="token punctuation">.</span><span class="token function">setSubType</span><span class="token punctuation">(</span><span class="token string">&quot;mixed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;创建邮件内容异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">return</span> mp<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.f7a9413c.js" defer></script><script src="/blog/assets/js/2.ddedf7b8.js" defer></script><script src="/blog/assets/js/25.b990b784.js" defer></script>
  </body>
</html>
